Подключение к сетевому оборудованию через терминальный сервер. Тестировался на сети МТС. Для подключения использовался SecureCRT. Терминальный сервер 10.73.1.3. 

```python
import json  
import time  
from netmiko import ConnectHandler, BaseConnection  
  
# Конфигурация для подключения к терминальному серверу  
device = {  
    'device_type': 'terminal_server',  
    'host': '10.73.1.3',  
    'username': 'логин',  
    'password': 'пароль',  
    'port': 22,  
    'session_log': 'session.log'  
}  
  
try:  
    # Подключение к терминальному серверу  
    net_connect: BaseConnection = ConnectHandler(**device)  
    print("Jump Server Prompt: {}".format(net_connect.find_prompt()))  
    print("\n\n")  
  
    # Пересылка на новое устройство через SSH  
    net_connect.write_channel("ssh логин@10.16.0.20\n")  
    time.sleep(3)  
  
    # Проверка запроса на ввод пароля  
    output = net_connect.read_channel()  
    if 'Password:' in output:  
        net_connect.write_channel('пароль\n')  
        time.sleep(3)  
  
    # Перенастройка Netmiko на новый тип устройства  
    net_connect.redispatch(device_type='cisco_ios')  
  
    # Проверка, что мы перешли на новое устройство  
    if print("Router Promt:{}".format(net_connect.find_prompt())):  
        print("Не удалось переключиться на второе устройство")  
        exit()  
  
    # Отправка команды и получение вывода  
    new_output = net_connect.send_command("sh ip int brief", use_textfsm=True)  
    print(new_output)  
  
    # Сохранение вывода в JSON-файл  
    with open('Вывод из Пайтона.json', 'w', encoding='utf-8') as f:  
        json.dump(new_output, f, indent=4, ensure_ascii=False)  
  
except Exception as e:  
    print(f"Произошла ошибка: {e}")  
finally:  
    # Закрытие сессии  
    if 'net_connect' in locals():  
        net_connect.disconnect()
```


Также использовались статьи [Автоматизация сетевого оборудования на Python. Работа через jump-host / Хабр](https://habr.com/ru/companies/rostelecom/articles/823282/)

________________________________________________________________________
Paths: [[Scripts]]
Tags: #Scripts   

