Рассмотрим процесс получения адреса:

1. Когда клиент загружается (или хочет присоединиться к сети), он начинает четырехэтапный процесс для получения аренды. Он запускает процесс с широковещательным (**broadcast**) сообщением **DHCPDISCOVER** со своим собственным MAC-адресом для обнаружения доступных серверов DHCPv4. Поскольку у клиента нет способа узнать подсеть, к которой он принадлежит, у сообщения **DHCPDISCOVER** адрес назначения IPv4 адреса -**255.255.255.255**. А поскольку у клиента еще нет настроенного адреса IPv4, то исходный IPv4-адрес - **0.0.0.0**.
2. Сообщение **DHCPDISCOVER** находит серверы DHCPv4 в сети. Поскольку клиент не имеет IPv4 информации при загрузке, он использует широковещательные адреса 2 и 3 уровня для связи с сервером.
3. Когда DHCPv4-сервер получает сообщение **DHCPDISCOVER**, он резервирует доступный IPv4-адрес для аренды клиенту. Сервер также создает запись ARP, состоящую из MAC-адреса клиента и арендованного IPv4-адреса DHCP сервер отправляет связанное сообщение **DHCPOFFER** запрашивающему клиенту, как одноадресная передача (**unicast**), используя MAC-адрес сервера в качестве исходного адреса и MAC-адрес клиента в качестве адреса доставки.
4. Когда клиент получает **DHCPOFFER** с сервера, он отправляет обратно сообщение **DHCPREQUEST**. Это сообщение используется как для получения, так и для продления аренды. Когда используется для получения аренды, **DHCPREQUEST** служит в качестве уведомления о принятии выбранных сервером параметров, которые он предложил, и отклонении предложения от других серверов. Многие корпоративные сети используют несколько DHCP серверов, и сообщение **DHCPREQUEST** отправляется в виде широковещательной передачи, чтобы информировать все серверы о принятом предложении.
5. При получении сообщения **DHCPREQUEST** сервер проверяет информацию об аренде с помощью ICMP-запроса на этот адрес, чтобы убедиться, что он уже не используется и создает новую **ARP** запись для аренды клиента, а затем отвечает одноадресным DHCPACK-сообщением. Это сообщение является дубликатом **DHCPOFFER**, за исключением изменения поля типа сообщения. Когда клиент получает сообщение **DHCPACK**, он регистрирует информацию и выполняет поиск ARP для назначенного адреса. Если ответа на ARP нет, клиент знает, что адрес IPv4 действителен и начинает использовать его как свой собственный.

![[DHCP.jpg]]
Теперь рассмотрим, как происходит продление аренды адреса:

1. Когда срок аренды истек, клиент отправляет сообщение **DHCPREQUEST** непосредственно DHCP серверу, который первоначально предлагал адрес. Если **DHCPACK** не получен в течение определенного периода времени, то клиент передает другой **DHCPREQUEST**, чтобы один из других доступных серверов DHCPv4 мог продлить аренду.
2. При получении сообщения **DHCPREQUEST** сервер проверяет информацию об аренде, возвращая **DHCPACK**


________________________________________________________________________
Paths: [[Networks]]
Tags: #Networks 